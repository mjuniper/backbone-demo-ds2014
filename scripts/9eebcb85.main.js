this.backboneDemoDs2014&&"object"==typeof this.backboneDemoDs2014||(this.backboneDemoDs2014={}),function(){"use strict";backboneDemoDs2014.GasPriceModel=Backbone.Model.extend({getDisplayValue:function(){var a=this.get("regular");return parseFloat(parseFloat(a.replace("$","")).toFixed(2))}}),backboneDemoDs2014.GasPricesCollection=Backbone.Collection.extend({model:backboneDemoDs2014.GasPriceModel,url:"http://apify.heroku.com/api/gasprices.json",fetch:function(a){return a=a||{},a.dataType="jsonp",Backbone.Collection.prototype.fetch.apply(this,[a])},parse:function(a){return JSON.parse(a)},getMin:function(){var a=this.min(function(a){return a.getDisplayValue()});return a.getDisplayValue()},getMax:function(){var a=this.max(function(a){return a.getDisplayValue()});return a.getDisplayValue()},findGasPrice:function(a){var b=this.findWhere({state:a});return b.getDisplayValue()}}),backboneDemoDs2014.LegendView=Backbone.View.extend({initialize:function(a){_.bindAll(this),this.legend=new esri.dijit.Legend({map:a.map,layerInfos:[{layer:a.fl,title:"Regular Gas"}]},"legend"),this.legend.startup(),this.tipTemplate=_.template("<strong><%= STATE_NAME %>:  $<%= GAS_DISPLAY %></strong>"),a.fl.on("mouse-over",this.showTip),a.fl.on("mouse-out",this.hideTip)},el:"#legend",showTip:function(a){this.$(".tip").html(this.tipTemplate(a.graphic.attributes))},hideTip:function(){this.$(".tip").empty()}}),backboneDemoDs2014.MapView=Backbone.View.extend({initialize:function(){_.bindAll(this);var a=new esri.geometry.Extent({xmin:-2332499,ymin:-1530060,xmax:2252197,ymax:1856904,spatialReference:{wkid:102003}});this.map=new esri.Map("map",{extent:a,lods:[{level:0,resolution:3966,scale:15e6}],slider:!1}),this.fl=new esri.layers.FeatureLayer("http://sampleserver6.arcgisonline.com/arcgis/rest/services/Census/MapServer/3",{maxAllowableOffset:this.map.extent.getWidth()/this.map.width,mode:esri.layers.FeatureLayer.MODE_SNAPSHOT,outFields:["STATE_NAME"],visible:!0}),this.fl.setRenderer(new esri.renderer.SimpleRenderer(null)),this.updateEndHandler=this.fl.on("update-end",this.onUpdateEnd),this.map.addLayer(this.fl),this.gasPricesCollection=new backboneDemoDs2014.GasPricesCollection},el:"#map",onUpdateEnd:function(){this.updateEndHandler.remove(),this.gasPricesCollection.fetch().done(this.drawFeatureLayer).fail(this.pricesError)},drawFeatureLayer:function(){var a,b=this.gasPricesCollection.getMin(),c=this.gasPricesCollection.getMax();_.each(this.fl.graphics,function(b){a=this.gasPricesCollection.findWhere({state:b.attributes.STATE_NAME}).getDisplayValue(),b.attributes.GAS_DISPLAY=a},this);var d=this.calcBreaks(b,c,4),e=esri.symbol.SimpleFillSymbol,f=esri.symbol.SimpleLineSymbol,g=f("solid",new dojo.Color("#444"),1),h=new esri.renderer.ClassBreaksRenderer(null,this.findGasPrice);h.setMaxInclusive(!0),h.addBreak(d[0],d[1],new e("solid",g,new dojo.Color([255,255,178,.75]))),h.addBreak(d[1],d[2],new e("solid",g,new dojo.Color([254,204,92,.75]))),h.addBreak(d[2],d[3],new e("solid",g,new dojo.Color([253,141,60,.75]))),h.addBreak(d[3],c,new e("solid",g,new dojo.Color([227,26,28,.75]))),this.fl.setRenderer(h),this.fl.redraw(),this.legend=new backboneDemoDs2014.LegendView({map:this.map,fl:this.fl}),$("#loading").remove()},findGasPrice:function(a){return this.gasPricesCollection.findGasPrice(a.attributes.STATE_NAME)},calcBreaks:function(a,b,c){for(var d=(b-a)/c,e=[],f=0;c>f;f++)e.push(this.formatDollars(a+d*f));return e},formatDollars:function(a){return dojo.number.format(a,{places:2})},pricesError:function(a){console.log("error getting gas price data: ",a)}})}(),$(function(){"use strict";require(["dojo/json","dojo/_base/connect","dojo/_base/Color","dojo/number","esri/map","esri/geometry/Extent","esri/symbols/SimpleLineSymbol","esri/symbols/SimpleFillSymbol","esri/renderers/SimpleRenderer","esri/renderers/ClassBreaksRenderer","esri/layers/FeatureLayer","esri/dijit/Legend","esri/request","dojo/domReady!"],function(){new backboneDemoDs2014.MapView})}),this.JST=this.JST||{};