window.backboneDemoDs2014={Models:{},Collections:{},Views:{},Routers:{},init:function(){"use strict";console.log("Hello from Backbone!"),require(["dojo/parser","dojo/json","dojo/_base/array","dojo/_base/connect","dojo/_base/Color","dojo/number","dojo/dom-construct","esri/map","esri/geometry/Extent","esri/symbols/SimpleLineSymbol","esri/symbols/SimpleFillSymbol","esri/renderers/SimpleRenderer","esri/renderers/ClassBreaksRenderer","esri/layers/FeatureLayer","esri/dijit/Legend","esri/request","extras/Tip","dijit/layout/BorderContainer","dijit/layout/ContentPane","dojo/domReady!"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){function r(a){var d=b.parse(a);console.log("join prices, number of graphics: ",fl.graphics.length),window.statePrices={};var f=1/0,h=-1/0;c.forEach(d,function(a){if("State"!==a.state){var b=parseFloat(parseFloat(a.regular.replace("$","")).toFixed(2));statePrices[a.state]=b,f>b&&(f=b),b>h&&(h=b)}}),h=u(h),c.forEach(fl.graphics,function(a){var b=statePrices[a.attributes.STATE_NAME].toFixed(2);a.attributes.GAS_DISPLAY=b});var i=t(f,h,4),l=k,n=j,p=n("solid",new e("#444"),1),q=new m(null,s);q.setMaxInclusive(!0),q.addBreak(i[0],i[1],new l("solid",p,new e([255,255,178,.75]))),q.addBreak(i[1],i[2],new l("solid",p,new e([254,204,92,.75]))),q.addBreak(i[2],i[3],new l("solid",p,new e([253,141,60,.75]))),q.addBreak(i[3],h,new l("solid",p,new e([227,26,28,.75]))),fl.setRenderer(q),fl.redraw();var r=new o({map:window.map,layerInfos:[{layer:fl,title:"Regular Gas"}]},"legend");r.startup(),g.destroy("loading")}function s(a){var b=a.attributes.STATE_NAME;return statePrices[b]}function t(a,b,c){for(var d=(b-a)/c,e=[],f=0;c>f;f++)e[f]=u(a+d*f);return e}function u(a){return f.format(a,{places:2})}function v(a){console.log("error getting gas price data: ",a)}a.parse();var w=new i({xmin:-2332499,ymin:-1530060,xmax:2252197,ymax:1856904,spatialReference:{wkid:102003}});window.map=new h("map",{extent:w,lods:[{level:0,resolution:3966,scale:15e6}],slider:!1}),window.fl=new n("http://sampleserver6.arcgisonline.com/arcgis/rest/services/Census/MapServer/3",{maxAllowableOffset:window.map.extent.getWidth()/window.map.width,mode:n.MODE_SNAPSHOT,outFields:["STATE_NAME"],visible:!0}),fl.setRenderer(new l(null));var x="<strong>${STATE_NAME}:  $${GAS_DISPLAY}</strong>";window.tip=new q({format:x,node:"legend"});var y=fl.on("update-end",function(){y.remove();var a=p({url:"http://apify.heroku.com/api/gasprices.json",callbackParamName:"callback"});a.then(r,v),fl.on("mouse-over",window.tip.showInfo),fl.on("mouse-out",window.tip.hideInfo)});window.map.addLayer(fl)})}},$(function(){"use strict";backboneDemoDs2014.init()}),this.JST=this.JST||{};